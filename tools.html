<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BAD TRIPP Tools</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#FFD700"/>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
    }
    h1 {
      color: gold;
    }
    .button {
      display: inline-block;
      padding: 15px 25px;
      margin: 15px;
      background-color: gold;
      color: black;
      font-weight: bold;
      font-size: 1.1em;
      text-decoration: none;
      border-radius: 5px;
      border: 2px solid gold;
      transition: 0.3s;
    }
    .button:hover {
      background-color: transparent;
      color: gold;
    }
    #app { display: none; }
    #lang {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #111;
      color: gold;
      padding: 6px 10px;
      border: 1px solid gold;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <select id="lang"><option value="en">ğŸ‡ºğŸ‡¸ English</option>
<option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
<option value="pt">ğŸ‡§ğŸ‡· Portuguese</option>
<option value="fr">ğŸ‡«ğŸ‡· French</option>
<option value="de">ğŸ‡©ğŸ‡ª German</option>
<option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
<option value="nl">ğŸ‡³ğŸ‡± Dutch</option>
<option value="pl">ğŸ‡µğŸ‡± Polish</option>
<option value="tr">ğŸ‡¹ğŸ‡· Turkish</option>
<option value="ru">ğŸ‡·ğŸ‡º Russian</option>
<option value="ja">ğŸ‡¯ğŸ‡µ Japanese</option>
<option value="zh">ğŸ‡¨ğŸ‡³ Chinese</option>
<option value="zh-TW">ğŸ‡¹ğŸ‡¼ Chinese (Traditional)</option>
<option value="ko">ğŸ‡°ğŸ‡· Korean</option>
<option value="ar">ğŸ‡¸ğŸ‡¦ Arabic</option>
<option value="hi">ğŸ‡®ğŸ‡³ Hindi</option>
<option value="id">ğŸ‡®ğŸ‡© Indonesian</option>
<option value="th">ğŸ‡¹ğŸ‡­ Thai</option>
<option value="vi">ğŸ‡»ğŸ‡³ Vietnamese</option></select>
  <div id="app">
    <h1 id="title">BAD TRIPP Tools</h1>
    <p id="prompt">Select your tool below:</p>
    <a href="development-buff-calculator-mobile.html" class="button">ğŸ§ª Buff Calculator</a><br>
    <a href="resource-production-calculator-mobile.html" class="button">ğŸ’° Resource Calculator</a><br>
    <a href="hq-upgrade-tracker-mobile.html" class="button">ğŸ“ˆ HQ Upgrade Tracker</a><br>
    <footer style="margin-top: 30px; color: #888;">Â© BAD TRIPP â€¢ All Rights Reserved</footer>
  </div>
  <script>
    const query = new URLSearchParams(window.location.search);
    const licenseKey = query.get("license");

async function validateLicense(key) {
  const res = await fetch('https://api.gumroad.com/v2/licenses/verify', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      product_id: 'bad-tripp-tools', // âœ… Use your actual Gumroad Product ID
      license_key: key
    })
  });

  const data = await res.json();
  alert('ğŸ” Gumroad API Response:\n' + JSON.stringify(data, null, 2));
  return data.success;
}

    async function enforceAccess() {
      let key = licenseKey || localStorage.getItem("gumroad_license");
      if (!key) {
        key = prompt("Enter your Gumroad license key:");
      }
      if (!key) {
        window.location.href = "https://www.lastwartutorial.com/";
        return;
      }
      const valid = await validateLicense(key);
      if (valid) {
        localStorage.setItem("gumroad_license", key);
        document.getElementById("app").style.display = "block";
      } else {
        alert("Invalid license.");
        localStorage.removeItem("gumroad_license");
        window.location.href = "https://www.lastwartutorial.com/";
      }
    }

    async function loadLanguage(code) {
      const res = await fetch("lang.json");
      const lang = await res.json();
      const data = lang[code] || lang["en"];
      document.getElementById("title").textContent = data.title;
      document.getElementById("prompt").textContent = data.select_tool;
    }

    document.getElementById("lang").addEventListener("change", e => loadLanguage(e.target.value));

    window.addEventListener("load", () => {
      const userLang = navigator.language.slice(0, 2);
      document.getElementById("lang").value = userLang;
      loadLanguage(userLang);
      enforceAccess();
    });

    // PWA install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      setTimeout(() => {
        if (confirm("Install BAD TRIPP Tools as an app?")) {
          deferredPrompt.prompt();
        }
      }, 2000);
    });
  </script>
</body>
</html>
