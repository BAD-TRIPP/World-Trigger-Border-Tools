<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BAD TRIPP Tools</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#FFD700"/>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
    }
    h1 {
      color: gold;
    }
    .button {
      display: inline-block;
      padding: 15px 25px;
      margin: 15px;
      background-color: gold;
      color: black;
      font-weight: bold;
      font-size: 1.1em;
      text-decoration: none;
      border-radius: 5px;
      border: 2px solid gold;
      transition: 0.3s;
    }
    .button:hover {
      background-color: transparent;
      color: gold;
    }
    #app { display: none; }
    #lang {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #111;
      color: gold;
      padding: 6px 10px;
      border: 1px solid gold;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <select id="lang"><option value="en">🇺🇸 English</option>
<option value="es">🇪🇸 Spanish</option>
<option value="pt">🇧🇷 Portuguese</option>
<option value="fr">🇫🇷 French</option>
<option value="de">🇩🇪 German</option>
<option value="it">🇮🇹 Italian</option>
<option value="nl">🇳🇱 Dutch</option>
<option value="pl">🇵🇱 Polish</option>
<option value="tr">🇹🇷 Turkish</option>
<option value="ru">🇷🇺 Russian</option>
<option value="ja">🇯🇵 Japanese</option>
<option value="zh">🇨🇳 Chinese</option>
<option value="zh-TW">🇹🇼 Chinese (Traditional)</option>
<option value="ko">🇰🇷 Korean</option>
<option value="ar">🇸🇦 Arabic</option>
<option value="hi">🇮🇳 Hindi</option>
<option value="id">🇮🇩 Indonesian</option>
<option value="th">🇹🇭 Thai</option>
<option value="vi">🇻🇳 Vietnamese</option></select>
  <div id="app">
    <h1 id="title">BAD TRIPP Tools</h1>
    <p id="prompt">Select your tool below:</p>
    <a href="development-buff-calculator-mobile.html" class="button">🧪 Buff Calculator</a><br>
    <a href="resource-production-calculator-mobile.html" class="button">💰 Resource Calculator</a><br>
    <a href="hq-upgrade-tracker-mobile.html" class="button">📈 HQ Upgrade Tracker</a><br>
    <footer style="margin-top: 30px; color: #888;">© BAD TRIPP • All Rights Reserved</footer>
  </div>
  <script>
    const query = new URLSearchParams(window.location.search);
    const licenseKey = query.get("license");

async function validateLicense(key) {
  const res = await fetch('https://api.gumroad.com/v2/licenses/verify', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      product_id: 'bad-tripp-tools', // ✅ Use your actual Gumroad Product ID
      license_key: key
    })
  });

  const data = await res.json();
  alert('🔍 Gumroad API Response:\n' + JSON.stringify(data, null, 2));
  return data.success;
}

    async function enforceAccess() {
      let key = licenseKey || localStorage.getItem("gumroad_license");
      if (!key) {
        key = prompt("Enter your Gumroad license key:");
      }
      if (!key) {
        window.location.href = "https://www.lastwartutorial.com/";
        return;
      }
      const valid = await validateLicense(key);
      if (valid) {
        localStorage.setItem("gumroad_license", key);
        document.getElementById("app").style.display = "block";
      } else {
        alert("Invalid license.");
        localStorage.removeItem("gumroad_license");
        window.location.href = "https://www.lastwartutorial.com/";
      }
    }

    async function loadLanguage(code) {
      const res = await fetch("lang.json");
      const lang = await res.json();
      const data = lang[code] || lang["en"];
      document.getElementById("title").textContent = data.title;
      document.getElementById("prompt").textContent = data.select_tool;
    }

    document.getElementById("lang").addEventListener("change", e => loadLanguage(e.target.value));

    window.addEventListener("load", () => {
      const userLang = navigator.language.slice(0, 2);
      document.getElementById("lang").value = userLang;
      loadLanguage(userLang);
      enforceAccess();
    });

    // PWA install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      setTimeout(() => {
        if (confirm("Install BAD TRIPP Tools as an app?")) {
          deferredPrompt.prompt();
        }
      }, 2000);
    });
  </script>
</body>
</html>
