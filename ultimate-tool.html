<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BAD TRIPP Resource & Upgrade Planner</title>

<link href="https://cdn.jsdelivr.net/npm/intro.js/minified/introjs.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/intro.js/themes/introjs-dark.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/intro.js/minified/intro.min.js"></script>

<style>
body { background-color: #000; color: #f0f0f0; font-family: Arial, sans-serif; text-align: center; padding: 10px; }
.container { max-width: 700px; margin: auto; }
h1, h3 { color: gold; }
input, select, button { padding: 8px; border-radius: 4px; }
button { background-color: gold; color: black; border: 2px solid gold; font-weight: bold; }
button:hover { background-color: black; color: gold; }
.resource-section { border: 1px solid #444; border-radius: 5px; padding: 10px; margin: 10px 0; }
.result-box { background-color: #222; color: gold; padding: 10px; border-radius: 5px; }
</style>

<script>
if (!localStorage.getItem("badtripp_access_granted")) {
    const password = prompt("Enter pass to access BAD TRIPP's Tools:");
    if (password === "1009") {
        localStorage.setItem("badtripp_access_granted", "true");
    } else {
        alert("Access denied.");
        window.location.href = "https://www.lastwartutorial.com/";
    }
}
</script>
</head>

<body>
<div class="container">
<img src="bad_tripp_logo.png" style="max-width:200px;"><br>
<h1>BAD TRIPP Resource & Upgrade Planner</h1>
<button onclick="startTour()">üöÄ Start Guided Tour</button>

<div class="resource-section">
<h3>Step 1Ô∏è‚É£: HQ Level</h3>
<input type="number" id="hqLevel" placeholder="HQ Level (2-35)" min="2" max="35" oninput="saveData()">
</div>

<div class="resource-section">
<h3>Step 2Ô∏è‚É£: Resource Buildings</h3>
<div id="buildings"></div>
<button onclick="addBuilding()">+ Add Building</button>
</div>

<div class="resource-section">
<h3>Step 3Ô∏è‚É£: Buffs & Secretary</h3>
<input type="number" id="farmBuff" placeholder="Food Buff %" oninput="saveData()">
<input type="number" id="ironBuff" placeholder="Iron Buff %" oninput="saveData()">
<input type="number" id="coinBuff" placeholder="Coin Buff %" oninput="saveData()"><br><br>
<input type="number" id="secretaryUses" placeholder="Secretary Uses" oninput="saveData()">
</div>

<div class="resource-section">
<button onclick="calculateProduction()">üßÆ Calculate</button>
<button onclick="resetForm()">‚ôªÔ∏è Reset</button>
<div class="result-box" id="results">Results will appear here.</div>
</div>

<div class="resource-section">
<h3>Step 5Ô∏è‚É£: HQ Requirements</h3>
<input type="number" id="hqTargetLevel" placeholder="Target HQ Level" oninput="saveData()">
<button onclick="checkHQRequirements()">Check</button>
<div class="result-box" id="hqResult">HQ Requirements: -</div>
</div>

<button onclick="toggleTheme()">Toggle Dark/Light Theme</button>
</div>

<script>
const farm = [0,100,200,300,400,500,600,750,900,1100,1300,1500,1800,2100,2500,3000,3600,4300,5100,6000,7000,8200,9500,11000,12500,14000,16000,18000,20500,23000,26000,29000,32000,35000,38000,42000];
const iron = [0,90,180,270,360,450,540,675,810,950,1100,1300,1550,1800,2100,2400,2800,3300,3800,4400,5100,5900,6700,7600,8500,9500,10700,11900,13200,14500,16000,17500,19000,21000,23000,25000];
const coin = [0,50,100,150,200,250,320,400,480,580,700,850,1000,1200,1400,1700,2000,2300,2700,3100,3600,4200,4800,5500,6300,7200,8200,9300,10500,11800,13200,14700,16300,18000,19800,22000];

const hqReq = {2:[{b:'drillGround',lvl:1}],3:[{b:'wall',lvl:3}],5:[{b:'wall',lvl:4}],10:[{b:'techCenter',lvl:9}],15:[{b:'allianceCenter',lvl:15}],20:[{b:'drillGround',lvl:20}],25:[{b:'wall',lvl:25}],30:[{b:'hospital',lvl:30}],35:[{b:'techCenter',lvl:34}]};

function addBuilding(type, qty, lvl) {
    const div = document.createElement('div');
    div.innerHTML = `
    <select onchange="saveData()">
        <option value="farm">Farm</option>
        <option value="iron">Iron</option>
        <option value="coin">Coin</option>
    </select>
    <input type="number" placeholder="Qty" onchange="saveData()" value="${qty||''}">
    <input type="number" placeholder="Level" onchange="saveData()" value="${lvl||''}">
    <button onclick="this.parentNode.remove(); saveData()">‚ùå</button>`;
    if(type) div.querySelector('select').value = type;
    document.getElementById('buildings').appendChild(div);
    saveData();
}

function calculateProduction() {
    let total = {farm:0,iron:0,coin:0};
    document.querySelectorAll('#buildings div').forEach(div=>{
        let t = div.querySelector('select').value;
        let qty = parseInt(div.querySelectorAll('input')[0].value)||0;
        let lvl = parseInt(div.querySelectorAll('input')[1].value)||0;
        let base = (t==='farm'?farm:t==='iron'?iron:coin)[lvl]||0;
        total[t] += qty * base;
    });
    const buffs = {
        farm:parseFloat(farmBuff.value)||0,
        iron:parseFloat(ironBuff.value)||0,
        coin:parseFloat(coinBuff.value)||0
    };
    const sec = parseFloat(secretaryUses.value)||0;
    let html = '';
    ['farm','iron','coin'].forEach(type=>{
        let hourly = total[type]*(1+buffs[type]/100);
        let daily = hourly*24;
        let bonus = hourly*(5/60)*sec;
        html += `<b>${type.toUpperCase()}</b>: Hourly ${hourly.toFixed(0)} | Daily ${(daily+bonus).toFixed(0)} (+${bonus.toFixed(0)} Secretary)<br>`;
    });
    results.innerHTML = html;
    saveData(); // Save the results too!
}

function resetForm(){
    document.getElementById('buildings').innerHTML='';
    ['farmBuff','ironBuff','coinBuff','secretaryUses','hqLevel','hqTargetLevel'].forEach(id=>document.getElementById(id).value='');
    results.innerHTML='Results will appear here.';
    hqResult.innerHTML='HQ Requirements: -';
    localStorage.removeItem('badtripp_data');
    localStorage.removeItem('badtripp_theme');
}

function checkHQRequirements(){
    const lvl=parseInt(hqTargetLevel.value);
    const reqs=hqReq[lvl]||[];
    hqResult.innerHTML=reqs.length?reqs.map(r=>`${r.b}: Level ${r.lvl}`).join('<br>'):'No special requirements.';
    saveData();
}

function startTour(){
    introJs().setOptions({steps:[
        {intro:'üëã Welcome to BAD TRIPP Planner!'},
        {element:'#hqLevel',intro:'Enter HQ Level.'},
        {element:'#buildings',intro:'Add buildings.'},
        {element:'#farmBuff',intro:'Enter buffs.'},
        {element:'#secretaryUses',intro:'Secretary sessions.'},
        {element:'#results',intro:'Calculate to see production.'},
        {element:'#hqTargetLevel',intro:'Check HQ requirements.'}
    ]}).start();
}

function toggleTheme(){
    const dark = document.body.style.backgroundColor === 'black' || !document.body.style.backgroundColor;
    if(dark){
        document.body.style.backgroundColor='#f0f0f0';document.body.style.color='#000';
        localStorage.setItem('badtripp_theme','light');
    } else {
        document.body.style.backgroundColor='black';document.body.style.color='#f0f0f0';
        localStorage.setItem('badtripp_theme','dark');
    }
}

// AUTO SAVE & LOAD
function saveData(){
    const data = {
        hqLevel:hqLevel.value,
        farmBuff:farmBuff.value,
        ironBuff:ironBuff.value,
        coinBuff:coinBuff.value,
        secretaryUses:secretaryUses.value,
        hqTargetLevel:hqTargetLevel.value,
        results:results.innerHTML,
        buildings:[]
    };
    document.querySelectorAll('#buildings div').forEach(div=>{
        data.buildings.push([
            div.querySelector('select').value,
            div.querySelectorAll('input')[0].value,
            div.querySelectorAll('input')[1].value
        ]);
    });
    localStorage.setItem('badtripp_data',JSON.stringify(data));
}

function loadData(){
    const data = JSON.parse(localStorage.getItem('badtripp_data')||'{}');
    if(data.hqLevel) hqLevel.value=data.hqLevel;
    if(data.farmBuff) farmBuff.value=data.farmBuff;
    if(data.ironBuff) ironBuff.value=data.ironBuff;
    if(data.coinBuff) coinBuff.value=data.coinBuff;
    if(data.secretaryUses) secretaryUses.value=data.secretaryUses;
    if(data.hqTargetLevel) hqTargetLevel.value=data.hqTargetLevel;
    if(data.buildings) data.buildings.forEach(b=>addBuilding(b[0],b[1],b[2]));
    if(data.results) results.innerHTML = data.results;

    // Load theme
    const theme = localStorage.getItem('badtripp_theme');
    if(theme==='light'){
        document.body.style.backgroundColor='#f0f0f0';
        document.body.style.color='#000';
    } else {
        document.body.style.backgroundColor='black';
        document.body.style.color='#f0f0f0';
    }
}

window.onload = loadData;
</script>
</body>
</html>
